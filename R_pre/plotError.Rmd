---
title: "Position error"
output:
  bookdown::html_document2:
    number_sections: false

date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

## add column  to shp.stat for plotting
shp.stat$plot <- "station"

## get plotting dimensions
dimC <- st_bbox(shp[shp$site == "maisC",])
dimD <- st_bbox(shp[shp$site == "maisD",])

```


```{r}


## plot example for methods
ggplot() + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b700[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b600[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b500[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b400[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b300[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b200[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b100[[1]], lwd = 2) + 
  geom_sf(data = shp.stat[shp.stat$station.id == "c1l1",], pch = 2, color = "white") + 
  scale_fill_viridis_d("station density", direction = -1, option = "rocket", alpha = 0.4) +
  theme_light()

## plot example for methods
ggplot() + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b700[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b600[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b500[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b400[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b300[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b200[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b100[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b700[[2]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b600[[2]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b500[[2]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b400[[2]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b300[[2]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b200[[2]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b100[[2]], lwd = 2) + 
  geom_sf(data = shp.stat[shp.stat$station.id == "c1l1",], pch = 2, color = "white") + 
  geom_sf(data = shp.stat[shp.stat$station.id == "c2l1",], pch = 2, color = "white") + 
  scale_fill_viridis_d("station density", direction = -1, option = "rocket", alpha = 0.4) +
  theme_light()
```

## station denisty raster {.tabset}

### maisC

```{r}
## clip raster to maisC
df.rC <- st_intersection(st_transform(df.r, crs = crs), st_union(st_buffer(st_transform(shp.stat[shp.stat$station.project_id == "maisC",], crs = crs), dist = rast_buf)))

## plot raster (= merged polygons)
ggplot() + 
  geom_sf(aes(fill = dens, color = dens), data = df.rC, lwd = 0.1) + 
  geom_sf(data = shp.stat[shp.stat$station.project_id == "maisC",], pch = 2, color = "white") + 
  # geom_sf(data = df[100000:100100,], pch = 1, color = "grey80", alpha = 0.5) + # check whether dimensions are correct
  scale_fill_viridis_c("station density", direction = -1, option = "rocket", na.value = NA) +
  scale_color_viridis_c("station density", direction = -1, option = "rocket", na.value = NA) +
  annotation_scale(width_hint = 0.2, bar_cols = c("grey60", "white"), color = "grey60") +
  theme_light()
```

### maisD

```{r}
## clip raster to maisD
df.rD <- st_intersection(st_transform(df.r, crs = crs), st_union(st_buffer(st_transform(shp.stat[shp.stat$station.project_id == "maisD",], crs = crs), dist = rast_buf)))
## plot raster (= merged polygons)
ggplot() + 
  geom_sf(aes(fill = dens, color = dens), data = df.rD, lwd = 0.1) + 
  geom_sf(data = shp.stat[shp.stat$station.project_id == "maisD",], pch = 2, color = "white") + 
  # geom_sf(data = df[100000:100100,], pch = 1, color = "grey80", alpha = 0.5) + # check whether dimensions are correct
  scale_fill_viridis_c("station density", direction = -1, option = "rocket", na.value = NA) +
  scale_color_viridis_c("station density", direction = -1, option = "rocket", na.value = NA) +
  annotation_scale(width_hint = 0.2, bar_cols = c("grey60", "white"), color = "grey60") +
  theme_light()
```

# position error per station density (est. positions) {.tabset}

## maisC

```{r}
for(m in unique(df$meth[df$site == "maisC"])) {
  dat <- df[df$site == "maisC" & df$meth == m & df$ant == "1-10",]
  dat.m <- df.m[df.m$site == "maisC" & df.m$meth == m & df.m$ant == "1-10",]

  print(ggplot(dat) +
    # geom_point(aes(x = dens, y = dist, color = detR, group = detR),
    #            pch = 1, alpha = 0.2,
    #            position = position_dodge(width = 0.5)) +
    geom_smooth(aes(x = dens, y = dist, group = detR, color = detR), method = "glm", formula = y ~ poly(x, 2)) +
    geom_smooth(aes(x = dens, y = dist, group = detR, color = detR), method = "glm", formula = y ~ poly(x, 2), data = dat.m, lty = "dashed") +
    ggtitle(m, subtitle = "position error (solid), position error from mean positions (dashed)") +
    ylab("position error [m]") +
    ylim(0, NA) +
    facet_wrap(~Individual, scales = "free_y") +
    scale_color_viridis_d() +
    theme_light())  
  
}

```

## maisD

```{r}
for(m in unique(df$meth[df$site == "maisD"])) {
  dat <- df[df$site == "maisD" & df$meth == m,]
  dat.m <- df.m[df.m$site == "maisD" & df.m$meth == m,]

  print(ggplot(dat) +
    # geom_point(aes(x = dens, y = dist, color = detR, group = detR),
    #            pch = 1, alpha = 0.2,
    #            position = position_dodge(width = 0.5)) +
    geom_smooth(aes(x = dens, y = dist, group = detR, color = detR), method = "glm", formula = y ~ poly(x, 2)) +
    geom_smooth(aes(x = dens, y = dist, group = detR, color = detR), method = "glm", formula = y ~ poly(x, 2), data = dat.m, lty = "dashed") +
    ggtitle(m, subtitle = "position error (solid), position error from mean positions (dashed)") +
    ylab("position error [m]") +
    ylim(0, NA) +
    facet_wrap(~Individual, scales = "free_y") +
    scale_color_viridis_d() +
    theme_light())  
  
}

```


## maisC (raw, mean)

```{r}
for(m in unique(df$meth[df$site == "maisC"])) {
  dat.m <- df.m[df.m$site == "maisC" & df.m$meth == m & df.m$ant == "1-10",]

  print(ggplot(dat.m) +
    geom_point(aes(x = dens, y = dist, color = detR, group = detR),
               pch = 1, alpha = 0.2,
               position = position_dodge(width = 0.5)) +
    geom_smooth(aes(x = dens, y = dist, group = detR, color = detR), method = "glm", formula = y ~ poly(x, 2), lty = "dashed") +
    ggtitle(m, subtitle = "position error from mean positions (dashed)") +
    ylab("position error [m]") +
    ylim(0, NA) +
    facet_wrap(~Individual, scales = "free_y") +
    scale_color_viridis_d() +
    theme_light())  
  
}

```

## maisD (raw, mean)

```{r}
for(m in unique(df$meth[df$site == "maisD"])) {
  dat.m <- df.m[df.m$site == "maisD" & df.m$meth == m,]

  print(ggplot(dat.m) +
    geom_point(aes(x = dens, y = dist, color = detR, group = detR),
               pch = 1, alpha = 0.2,
               position = position_dodge(width = 0.5)) +
    geom_smooth(aes(x = dens, y = dist, group = detR, color = detR), method = "glm", formula = y ~ poly(x, 2), lty = "dashed") +
    ggtitle(m, subtitle = "position error from mean positions (dashed)") +
    ylab("position error [m]") +
    ylim(0, NA) +
    facet_wrap(~Individual, scales = "free_y") +
    scale_color_viridis_d() +
    theme_light())  
  
}

```


# raster
These plots show summarized raster (`r rast_res*rast_inc`x`r rast_res*rast_inc` m resolution) based on positions from testtags with ground truth data (GPS data). Each plot is split by individual (= testtag, e.g. TT090C) and separate plots were made per method (*ab_ql* = antenna beams quadro-logger, *ab_ml* = antenna beams mono-logger, *ml_ml* = mulitlateration mono-logger, *in_ql* = intersection quadro-logger)  

**abbreviations in tabs:**  
- *rp*: raw positions (no rolling mean applied)  
- *mp*: mean positions (rolling mean applied to rp)  
- *tp*: true GPS positions (reference for position error are mp)  
- *mean*: mean position error  
- *sd*: sd of position error  
- *N*: number of points  


---

## maisC {.tabset}

### mean rp

```{r}
site <- "maisC"
dim <- dimC
ant <- "1-10"

## plot raster (= merged polygons)
for(m in unique(shp$meth[shp$site == site])) {
  for(d in unique(shp$detR[shp$site == site & shp$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp[shp$site == site & shp$ant == ant & shp$meth == m & shp$detR == d,], 
              aes(fill = mean, color = mean), lwd = 0.1)
    g <- plot.raster(g, leg = "mean \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g) +
      coord_sf(xlim = c(dim[1], dim[3]), ylim = c(dim[2], dim[4])))
  }
}

```

### median rp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp$meth[shp$site == site])) {
  for(d in unique(shp$detR[shp$site == site & shp$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp[shp$site == site & shp$ant == ant & shp$meth == m & shp$detR == d,], 
              aes(fill = median, color = median), lwd = 0.1)
    g <- plot.raster(g, leg = "median \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}
```

### sd rp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp$meth[shp$site == site])) {
  for(d in unique(shp$detR[shp$site == site & shp$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp[shp$site == site & shp$ant == ant & shp$meth == m & shp$detR == d,], 
              aes(fill = sd, color = sd), lwd = 0.1)
    g <- plot.raster(g, leg = "sd \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### N rp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp$meth[shp$site == site])) {
  for(d in unique(shp$detR[shp$site == site & shp$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp[shp$site == site & shp$ant == ant & shp$meth == m & shp$detR == d,], 
              aes(fill = N, color = N), lwd = 0.1)
    g <- plot.raster(g, leg = "N points")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### mean mp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.m$meth[shp.m$site == site])) {
  for(d in unique(shp.m$detR[shp.m$site == site & shp.m$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp.m[shp.m$site == site & shp.m$ant == ant & 
                             shp.m$meth == m & shp.m$detR == d,], 
              aes(fill = mean, color = mean), lwd = 0.1)
    g <- plot.raster(g, leg = "mean \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### median mp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.m$meth[shp.m$site == site])) {
  for(d in unique(shp.m$detR[shp.m$site == site & shp.m$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp.m[shp.m$site == site & shp.m$ant == ant & 
                             shp.m$meth == m & shp.m$detR == d,], 
              aes(fill = median, color = median), lwd = 0.1)
    g <- plot.raster(g, leg = "median \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### sd mp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.m$meth[shp.m$site == site])) {
  for(d in unique(shp.m$detR[shp.m$site == site & shp.m$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp.m[shp.m$site == site & shp.m$ant == ant & 
                             shp.m$meth == m & shp.m$detR == d,], 
              aes(fill = sd, color = sd), lwd = 0.1)
    g <- plot.raster(g, leg = "sd \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### N mp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.m$meth[shp.m$site == site])) {
  for(d in unique(shp.m$detR[shp.m$site == site & shp.m$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp.m[shp.m$site == site & shp.m$ant == ant & 
                             shp.m$meth == m & shp.m$detR == d,], 
              aes(fill = N, color = N), lwd = 0.1)
    g <- plot.raster(g, leg = "N points")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### mean tp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.t$meth[shp.t$site == site])) {
  for(d in unique(shp.t$detR[shp.t$site == site & shp.t$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp.t[shp.t$site == site & shp.t$ant == ant & 
                             shp.t$meth == m & shp.t$detR == d,], 
              aes(fill = mean, color = mean), lwd = 0.1)
    g <- plot.raster(g, leg = "mean \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```


### median tp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.t$meth[shp.t$site == site])) {
  for(d in unique(shp.t$detR[shp.t$site == site & shp.t$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp.t[shp.t$site == site & shp.t$ant == ant & 
                             shp.t$meth == m & shp.t$detR == d,], 
              aes(fill = median, color = median), lwd = 0.1)
    g <- plot.raster(g, leg = "median \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### sd tp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.t$meth[shp.t$site == site])) {
  for(d in unique(shp.t$detR[shp.t$site == site & shp.t$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp.t[shp.t$site == site & shp.t$ant == ant & 
                             shp.t$meth == m & shp.t$detR == d,], 
              aes(fill = sd, color = sd), lwd = 0.1)
    g <- plot.raster(g, leg = "sd \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### N tp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.t$meth[shp.t$site == site])) {
  for(d in unique(shp.t$detR[shp.t$site == site & shp.t$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp.t[shp.t$site == site & shp.t$ant == ant & 
                             shp.t$meth == m & shp.t$detR == d,], 
              aes(fill = N, color = N), lwd = 0.1)
    g <- plot.raster(g, leg = "N points")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

## maisD {.tabset}

### mean rp

```{r}
site <- "maisD"
dim <- dimD
ant <- "1-8"

## plot raster (= merged polygons)
for(m in unique(shp$meth[shp$site == site])) {
  for(d in unique(shp$detR[shp$site == site & shp$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp[shp$site == site & shp$ant == ant & shp$meth == m & shp$detR == d,], 
              aes(fill = mean, color = mean), lwd = 0.1)
    g <- plot.raster(g, leg = "mean \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### median rp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp$meth[shp$site == site])) {
  for(d in unique(shp$detR[shp$site == site & shp$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp[shp$site == site & shp$ant == ant & shp$meth == m & shp$detR == d,], 
              aes(fill = median, color = median), lwd = 0.1)
    g <- plot.raster(g, leg = "median \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}
```

### sd rp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp$meth[shp$site == site])) {
  for(d in unique(shp$detR[shp$site == site & shp$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp[shp$site == site & shp$ant == ant & shp$meth == m & shp$detR == d,], 
              aes(fill = sd, color = sd), lwd = 0.1)
    g <- plot.raster(g, leg = "sd \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### N rp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp$meth[shp$site == site])) {
  for(d in unique(shp$detR[shp$site == site & shp$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp[shp$site == site & shp$ant == ant & shp$meth == m & shp$detR == d,], 
              aes(fill = N, color = N), lwd = 0.1)
    g <- plot.raster(g, leg = "N points")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### mean mp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.m$meth[shp.m$site == site])) {
  for(d in unique(shp.m$detR[shp.m$site == site & shp.m$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp.m[shp.m$site == site & shp.m$ant == ant & 
                             shp.m$meth == m & shp.m$detR == d,], 
              aes(fill = mean, color = mean), lwd = 0.1)
    g <- plot.raster(g, leg = "mean \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### median mp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.m$meth[shp.m$site == site])) {
  for(d in unique(shp.m$detR[shp.m$site == site & shp.m$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp.m[shp.m$site == site & shp.m$ant == ant & 
                             shp.m$meth == m & shp.m$detR == d,], 
              aes(fill = median, color = median), lwd = 0.1)
    g <- plot.raster(g, leg = "median \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### sd mp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.m$meth[shp.m$site == site])) {
  for(d in unique(shp.m$detR[shp.m$site == site & shp.m$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp.m[shp.m$site == site & shp.m$ant == ant & 
                             shp.m$meth == m & shp.m$detR == d,], 
              aes(fill = sd, color = sd), lwd = 0.1)
    g <- plot.raster(g, leg = "sd \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### N mp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.m$meth[shp.m$site == site])) {
  for(d in unique(shp.m$detR[shp.m$site == site & shp.m$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp.m[shp.m$site == site & shp.m$ant == ant & 
                             shp.m$meth == m & shp.m$detR == d,], 
              aes(fill = N, color = N), lwd = 0.1)
    g <- plot.raster(g, leg = "N points")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### mean tp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.t$meth[shp.t$site == site])) {
  for(d in unique(shp.t$detR[shp.t$site == site & shp.t$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp.t[shp.t$site == site & shp.t$ant == ant & 
                             shp.t$meth == m & shp.t$detR == d,], 
              aes(fill = mean, color = mean), lwd = 0.1)
    g <- plot.raster(g, leg = "mean \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```


### median tp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.t$meth[shp.t$site == site])) {
  for(d in unique(shp.t$detR[shp.t$site == site & shp.t$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp.t[shp.t$site == site & shp.t$ant == ant & 
                             shp.t$meth == m & shp.t$detR == d,], 
              aes(fill = median, color = median), lwd = 0.1)
    g <- plot.raster(g, leg = "median \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### sd tp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.t$meth[shp.t$site == site])) {
  for(d in unique(shp.t$detR[shp.t$site == site & shp.t$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp.t[shp.t$site == site & shp.t$ant == ant & 
                             shp.t$meth == m & shp.t$detR == d,], 
              aes(fill = sd, color = sd), lwd = 0.1)
    g <- plot.raster(g, leg = "sd \nposition \nerror")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 1)
    print(plot.theme(g))      

  }
}

```

### N tp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.t$meth[shp.t$site == site])) {
  for(d in unique(shp.t$detR[shp.t$site == site & shp.t$meth == m])) {
    if(m %in% c("ab_ml", "ml_ml")) type <- "mono"
    if(m %in% c("ab_ql", "in_ql")) type <- "quadro"
    
    g <- ggplot() + 
      geom_sf(data = shp.t[shp.t$site == site & shp.t$ant == ant & 
                             shp.t$meth == m & shp.t$detR == d,], 
              aes(fill = N, color = N), lwd = 0.1)
    g <- plot.raster(g, leg = "N points")
    g <- plot.station(g, site = site, type = type, size = 2, stroke = 0.8)
    print(plot.theme(g))
  }
}

```