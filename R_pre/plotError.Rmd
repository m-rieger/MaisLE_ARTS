---
title: "Position error"
output:
  bookdown::html_document2:
    number_sections: false

date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(ggspatial) # for annotation bar

## add column  to df.stat for plotting
df.stat$plot <- "station"

## get plotting dimensions
dimC <- st_bbox(shp[shp$Project == "maisC",])
dimD <- st_bbox(shp[shp$Project == "maisD",])

```


```{r}


## plot example for methods
ggplot() + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b700[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b600[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b500[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b400[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b300[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b200[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b100[[1]], lwd = 2) + 
  geom_sf(data = df.stat[df.stat$station.id == "c1l1",], pch = 2, color = "white") + 
  scale_fill_viridis_d("station density", direction = -1, option = "rocket", alpha = 0.4) +
  theme_light()

## plot example for methods
ggplot() + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b700[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b600[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b500[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b400[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b300[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b200[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b100[[1]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b700[[2]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b600[[2]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b500[[2]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b400[[2]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b300[[2]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b200[[2]], lwd = 2) + 
  geom_sf(aes(fill = as.character(dens)), color = NA, data = b100[[2]], lwd = 2) + 
  geom_sf(data = df.stat[df.stat$station.id == "c1l1",], pch = 2, color = "white") + 
  geom_sf(data = df.stat[df.stat$station.id == "c2l1",], pch = 2, color = "white") + 
  scale_fill_viridis_d("station density", direction = -1, option = "rocket", alpha = 0.4) +
  theme_light()
```

## station denisty raster {.tabset}

### maisC

```{r}
## clip raster to maisC
df.rC <- st_intersection(st_transform(df.r, crs = crs), st_union(st_buffer(df.stat[df.stat$station.project_id == "maisC",], dist = 800)))
## plot raster (= merged polygons)
ggplot() + 
  geom_sf(aes(fill = dens, color = dens), data = df.rC, lwd = 0.1) + 
  geom_sf(data = df.stat[df.stat$station.project_id == "maisC",], pch = 2, color = "white") + 
  # geom_sf(data = df[100000:100100,], pch = 1, color = "grey80", alpha = 0.5) + # check whether dimensions are correct
  scale_fill_viridis_c("station density", direction = -1, option = "rocket", na.value = NA) +
  scale_color_viridis_c("station density", direction = -1, option = "rocket", na.value = NA) +
  annotation_scale(width_hint = 0.2, bar_cols = c("grey60", "white"), color = "grey60") +
  theme_light()
```

### maisD

```{r}
## clip raster to maisD
df.rD <- st_intersection(st_transform(df.r, crs = crs), st_union(st_buffer(df.stat[df.stat$station.project_id == "maisD",], dist = 800)))
## plot raster (= merged polygons)
ggplot() + 
  geom_sf(aes(fill = dens, color = dens), data = df.rD, lwd = 0.1) + 
  geom_sf(data = df.stat[df.stat$station.project_id == "maisD",], pch = 2, color = "white") + 
  # geom_sf(data = df[100000:100100,], pch = 1, color = "grey80", alpha = 0.5) + # check whether dimensions are correct
  scale_fill_viridis_c("station density", direction = -1, option = "rocket", na.value = NA) +
  scale_color_viridis_c("station density", direction = -1, option = "rocket", na.value = NA) +
  annotation_scale(width_hint = 0.2, bar_cols = c("grey60", "white"), color = "grey60") +
  theme_light()
```

# position error per station density (est. positions) {.tabset}

## maisC

```{r}
for(m in unique(df$meth[df$Project == "maisC"])) {
  dat <- df[df$Project == "maisC" & df$meth == m & df$ant == "1-10",]
  dat.m <- df.m[df.m$Project == "maisC" & df.m$meth == m & df.m$ant == "1-10",]

  print(ggplot(dat) +
    # geom_point(aes(x = dens, y = dist, color = detR, group = detR),
    #            pch = 1, alpha = 0.2,
    #            position = position_dodge(width = 0.5)) +
    geom_smooth(aes(x = dens, y = dist, group = detR, color = detR), method = "glm", formula = y ~ poly(x, 2)) +
    geom_smooth(aes(x = dens, y = dist, group = detR, color = detR), method = "glm", formula = y ~ poly(x, 2), data = dat.m, lty = "dashed") +
    ggtitle(m, subtitle = "position error (solid), position error from mean positions (dashed)") +
    ylab("position error [m]") +
    ylim(0, NA) +
    facet_wrap(~Individual, scales = "free_y") +
    scale_color_viridis_d() +
    theme_light())  
  
}

```

## maisD

```{r}
for(m in unique(df$meth[df$Project == "maisD"])) {
  dat <- df[df$Project == "maisD" & df$meth == m,]
  dat.m <- df.m[df.m$Project == "maisD" & df.m$meth == m,]

  print(ggplot(dat) +
    # geom_point(aes(x = dens, y = dist, color = detR, group = detR),
    #            pch = 1, alpha = 0.2,
    #            position = position_dodge(width = 0.5)) +
    geom_smooth(aes(x = dens, y = dist, group = detR, color = detR), method = "glm", formula = y ~ poly(x, 2)) +
    geom_smooth(aes(x = dens, y = dist, group = detR, color = detR), method = "glm", formula = y ~ poly(x, 2), data = dat.m, lty = "dashed") +
    ggtitle(m, subtitle = "position error (solid), position error from mean positions (dashed)") +
    ylab("position error [m]") +
    ylim(0, NA) +
    facet_wrap(~Individual, scales = "free_y") +
    scale_color_viridis_d() +
    theme_light())  
  
}

```


## maisC (raw, mean)

```{r}
for(m in unique(df$meth[df$Project == "maisC"])) {
  dat.m <- df.m[df.m$Project == "maisC" & df.m$meth == m & df.m$ant == "1-10",]

  print(ggplot(dat.m) +
    geom_point(aes(x = dens, y = dist, color = detR, group = detR),
               pch = 1, alpha = 0.2,
               position = position_dodge(width = 0.5)) +
    geom_smooth(aes(x = dens, y = dist, group = detR, color = detR), method = "glm", formula = y ~ poly(x, 2), lty = "dashed") +
    ggtitle(m, subtitle = "position error from mean positions (dashed)") +
    ylab("position error [m]") +
    ylim(0, NA) +
    facet_wrap(~Individual, scales = "free_y") +
    scale_color_viridis_d() +
    theme_light())  
  
}

```

## maisD (raw, mean)

```{r}
for(m in unique(df$meth[df$Project == "maisD"])) {
  dat.m <- df.m[df.m$Project == "maisD" & df.m$meth == m,]

  print(ggplot(dat.m) +
    geom_point(aes(x = dens, y = dist, color = detR, group = detR),
               pch = 1, alpha = 0.2,
               position = position_dodge(width = 0.5)) +
    geom_smooth(aes(x = dens, y = dist, group = detR, color = detR), method = "glm", formula = y ~ poly(x, 2), lty = "dashed") +
    ggtitle(m, subtitle = "position error from mean positions (dashed)") +
    ylab("position error [m]") +
    ylim(0, NA) +
    facet_wrap(~Individual, scales = "free_y") +
    scale_color_viridis_d() +
    theme_light())  
  
}

```


# raster
These plots show summarized raster (`r raster_resolution*raster_incr`x`r raster_resolution*raster_incr` m resolution) based on positions from testtags with ground truth data (GPS data). Each plot is split by individual (= testtag, e.g. TT090C) and separate plots were made per method (*ab_ql* = antenna beams quadro-logger, *ab_ml* = antenna beams mono-logger, *ml_ml* = mulitlateration mono-logger, *in_ql* = intersection quadro-logger)  

**abbreviations in tabs:**  
- *rp*: raw positions (no rolling mean applied)  
- *mp*: mean positions (rolling mean applied to rp)  
- *tp*: true GPS positions (reference for distance error are mp)  
- *mean*: mean distance error  
- *sd*: sd of distance error  
- *N*: number of points  


---

```{r}
## ggplot function for display
plot.display <- function(g, leg = " ", lim = c(0, 200)){
  g <- g +
      scale_fill_viridis_c(leg, direction = -1, option = "rocket", limits = lim, 
                           oob = scales::oob_squish, na.value = c(NA, "black")) +
      scale_color_viridis_c(leg, direction = -1, option = "rocket", limits = lim, 
                            oob = scales::oob_squish, na.value = c(NA, "black")) +
      scale_shape_manual(" ", values = c("station" = 24)) +
      ggtitle(paste0(m, " - detR ", d)) +
      facet_wrap(~Individual) +
      annotation_scale(width_hint = 0.2, bar_cols = c("grey60", "white"), 
                       location = "tl", height = unit(0.15, "cm")) +
      theme_light() +
      theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))
  print(g)
}
```


## maisC {.tabset}

### mean rp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp$meth[shp$Project == "maisC"])) {
  for(d in unique(shp$detR[shp$Project == "maisC" & shp$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp[shp$Project == "maisC" & shp$ant == "1-10" & shp$meth == m & shp$detR == d,], 
              aes(fill = mean, color = mean), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisC",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimC[1], dimC[3]), ylim = c(dimC[2], dimC[4]))
    plot.display(g, leg = "mean \ndistance \nerror")
  }
}

```

### median rp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp$meth[shp$Project == "maisC"])) {
  for(d in unique(shp$detR[shp$Project == "maisC" & shp$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp[shp$Project == "maisC" & shp$ant == "1-10" & shp$meth == m & shp$detR == d,], 
              aes(fill = median, color = median), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisC",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimC[1], dimC[3]), ylim = c(dimC[2], dimC[4]))
    plot.display(g, leg = "median \ndistance \nerror")
  }
}

```

### sd rp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp$meth[shp$Project == "maisC"])) {
  for(d in unique(shp$detR[shp$Project == "maisC" & shp$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp[shp$Project == "maisC" & shp$ant == "1-10" & shp$meth == m & shp$detR == d,], 
              aes(fill = sd, color = sd), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisC",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimC[1], dimC[3]), ylim = c(dimC[2], dimC[4]))
    plot.display(g, leg = "sd \ndistance \nerror", lim = c(0, 100))
  }
}

```

### N rp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp$meth[shp$Project == "maisC"])) {
  for(d in unique(shp$detR[shp$Project == "maisC" & shp$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp[shp$Project == "maisC" & shp$ant == "1-10" & shp$meth == m & shp$detR == d,], 
              aes(fill = N, color = N), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisC",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimC[1], dimC[3]), ylim = c(dimC[2], dimC[4]))
    plot.display(g, leg = "N points", lim = c(0, 200))
  }
}

```

### mean mp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.m$meth[shp.m$Project == "maisC"])) {
  for(d in unique(shp.m$detR[shp.m$Project == "maisC" & shp.m$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp.m[shp.m$Project == "maisC" & shp.m$ant == "1-10" & shp.m$meth == m & shp.m$detR == d,], 
              aes(fill = mean, color = mean), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisC",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimC[1], dimC[3]), ylim = c(dimC[2], dimC[4]))
    plot.display(g, leg = "mean \ndistance \nerror")
  }
}

```

### median mp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.m$meth[shp.m$Project == "maisC"])) {
  for(d in unique(shp.m$detR[shp.m$Project == "maisC" & shp.m$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp.m[shp.m$Project == "maisC" & shp.m$ant == "1-10" & shp.m$meth == m & shp.m$detR == d,], 
              aes(fill = median, color = median), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisC",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimC[1], dimC[3]), ylim = c(dimC[2], dimC[4]))
    plot.display(g, leg = "median \ndistance \nerror")
  }
}

```

### sd mp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.m$meth[shp.m$Project == "maisC"])) {
  for(d in unique(shp.m$detR[shp.m$Project == "maisC" & shp.m$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp.m[shp.m$Project == "maisC" & shp.m$ant == "1-10" & shp.m$meth == m & shp.m$detR == d,], 
              aes(fill = sd, color = sd), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisC",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimC[1], dimC[3]), ylim = c(dimC[2], dimC[4]))
    plot.display(g, leg = "sd \ndistance \nerror", lim = c(0, 100))
  }
}

```

### N mp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.m$meth[shp.m$Project == "maisC"])) {
  for(d in unique(shp.m$detR[shp.m$Project == "maisC" & shp.m$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp.m[shp.m$Project == "maisC" & shp.m$ant == "1-10" & shp.m$meth == m & shp.m$detR == d,], 
              aes(fill = N, color = N), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisC",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimC[1], dimC[3]), ylim = c(dimC[2], dimC[4]))
    plot.display(g, leg = "N points", lim = c(0, 200))
  }
}

```

### mean tp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.t$meth[shp.t$Project == "maisC"])) {
  for(d in unique(shp.t$detR[shp.t$Project == "maisC" & shp.t$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp.t[shp.t$Project == "maisC" & shp.t$ant == "1-10" & shp.t$meth == m & shp.t$detR == d,], 
              aes(fill = mean, color = mean), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisC",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimC[1], dimC[3]), ylim = c(dimC[2], dimC[4]))
    plot.display(g, leg = "mean \ndistance \nerror")
  }
}

```


### median tp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.t$meth[shp.t$Project == "maisC"])) {
  for(d in unique(shp.t$detR[shp.t$Project == "maisC" & shp.t$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp.t[shp.t$Project == "maisC" & shp.t$ant == "1-10" & shp.t$meth == m & shp.t$detR == d,], 
              aes(fill = median, color = median), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisC",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimC[1], dimC[3]), ylim = c(dimC[2], dimC[4]))
    plot.display(g, leg = "median \ndistance \nerror")
  }
}

```

### sd tp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.t$meth[shp.t$Project == "maisC"])) {
  for(d in unique(shp.t$detR[shp.t$Project == "maisC" & shp.t$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp.t[shp.t$Project == "maisC" & shp.t$ant == "1-10" & shp.t$meth == m & shp.t$detR == d,],  
              aes(fill = sd, color = sd), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisC",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimC[1], dimC[3]), ylim = c(dimC[2], dimC[4]))
    plot.display(g, leg = "sd \ndistance \nerror", lim = c(0, 100))
  }
}

```

### N tp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.t$meth[shp.t$Project == "maisC"])) {
  for(d in unique(shp.t$detR[shp.t$Project == "maisC" & shp.t$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp.t[shp.t$Project == "maisC" & shp.t$ant == "1-10" & shp.t$meth == m & shp.t$detR == d,],  
              aes(fill = N, color = N), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisC",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimC[1], dimC[3]), ylim = c(dimC[2], dimC[4]))
    plot.display(g, leg = "N points", lim = c(0, 200))
  }
}

```

## maisD {.tabset}

### mean rp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp$meth[shp$Project == "maisD"])) {
  for(d in unique(shp$detR[shp$Project == "maisD" & shp$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp[shp$Project == "maisD" & shp$ant == "1-8" & shp$meth == m & shp$detR == d,], 
              aes(fill = mean, color = mean), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisD",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimD[1], dimD[3]), ylim = c(dimD[2], dimD[4]))
    plot.display(g, leg = "mean \ndistance \nerror")
  }
}

```

### median rp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp$meth[shp$Project == "maisD"])) {
  for(d in unique(shp$detR[shp$Project == "maisD" & shp$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp[shp$Project == "maisD" & shp$ant == "1-8" & shp$meth == m & shp$detR == d,], 
              aes(fill = median, color = median), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisD",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimD[1], dimD[3]), ylim = c(dimD[2], dimD[4]))
    plot.display(g, leg = "median \ndistance \nerror")
  }
}

```

### sd rp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp$meth[shp$Project == "maisD"])) {
  for(d in unique(shp$detR[shp$Project == "maisD" & shp$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp[shp$Project == "maisD" & shp$ant == "1-8" & shp$meth == m & shp$detR == d,], 
              aes(fill = sd, color = sd), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisD",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimD[1], dimD[3]), ylim = c(dimD[2], dimD[4]))
    plot.display(g, leg = "sd \ndistance \nerror", lim = c(0, 100))
  }
}

```

### N rp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp$meth[shp$Project == "maisD"])) {
  for(d in unique(shp$detR[shp$Project == "maisD" & shp$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp[shp$Project == "maisD" & shp$ant == "1-8" & shp$meth == m & shp$detR == d,], 
              aes(fill = N, color = N), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisD",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimD[1], dimD[3]), ylim = c(dimD[2], dimD[4]))
    plot.display(g, leg = "N points", lim = c(0, 200))
  }
}

```

### mean mp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.m$meth[shp.m$Project == "maisD"])) {
  for(d in unique(shp.m$detR[shp.m$Project == "maisD" & shp.m$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp.m[shp.m$Project == "maisD" & shp.m$ant == "1-8" & shp.m$meth == m & shp.m$detR == d,], 
              aes(fill = mean, color = mean), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisD",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimD[1], dimD[3]), ylim = c(dimD[2], dimD[4]))
    plot.display(g, leg = "mean \ndistance \nerror")
  }
}

```

### median mp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.m$meth[shp.m$Project == "maisD"])) {
  for(d in unique(shp.m$detR[shp.m$Project == "maisD" & shp.m$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp.m[shp.m$Project == "maisD" & shp.m$ant == "1-8" & shp.m$meth == m & shp.m$detR == d,], 
              aes(fill = median, color = median), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisD",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimD[1], dimD[3]), ylim = c(dimD[2], dimD[4]))
    plot.display(g, leg = "median \ndistance \nerror")
  }
}

```

### sd mp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.m$meth[shp.m$Project == "maisD"])) {
  for(d in unique(shp.m$detR[shp.m$Project == "maisD" & shp.m$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp.m[shp.m$Project == "maisD" & shp.m$ant == "1-8" & shp.m$meth == m & shp.m$detR == d,], 
              aes(fill = sd, color = sd), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisD",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimD[1], dimD[3]), ylim = c(dimD[2], dimD[4]))
    plot.display(g, leg = "sd \ndistance \nerror", lim = c(0, 100))
  }
}

```

### N mp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.m$meth[shp.m$Project == "maisD"])) {
  for(d in unique(shp.m$detR[shp.m$Project == "maisD" & shp.m$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp.m[shp.m$Project == "maisD" & shp.m$ant == "1-8" & shp.m$meth == m & shp.m$detR == d,], 
              aes(fill = N, color = N), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisD",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimD[1], dimD[3]), ylim = c(dimD[2], dimD[4]))
    plot.display(g, leg = "N points", lim = c(0, 200))
  }
}

```

### mean tp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.t$meth[shp.t$Project == "maisD"])) {
  for(d in unique(shp.t$detR[shp.t$Project == "maisD" & shp.t$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp.t[shp.t$Project == "maisD" & shp.t$ant == "1-8" & shp.t$meth == m & shp.t$detR == d,], 
              aes(fill = mean, color = mean), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisD",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimD[1], dimD[3]), ylim = c(dimD[2], dimD[4]))
    plot.display(g, leg = "mean \ndistance \nerror")
  }
}

```


### median tp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.t$meth[shp.t$Project == "maisD"])) {
  for(d in unique(shp.t$detR[shp.t$Project == "maisD" & shp.t$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp.t[shp.t$Project == "maisD" & shp.t$ant == "1-8" & shp.t$meth == m & shp.t$detR == d,], 
              aes(fill = median, color = median), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisD",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimD[1], dimD[3]), ylim = c(dimD[2], dimD[4]))
    plot.display(g, leg = "median \ndistance \nerror")
  }
}

```

### sd tp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.t$meth[shp.t$Project == "maisD"])) {
  for(d in unique(shp.t$detR[shp.t$Project == "maisD" & shp.t$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp.t[shp.t$Project == "maisD" & shp.t$ant == "1-8" & shp.t$meth == m & shp.t$detR == d,],  
              aes(fill = sd, color = sd), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisD",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimD[1], dimD[3]), ylim = c(dimD[2], dimD[4]))
    plot.display(g, leg = "sd \ndistance \nerror", lim = c(0, 100))
  }
}

```

### N tp

```{r}
## plot raster (= merged polygons)
for(m in unique(shp.t$meth[shp.t$Project == "maisD"])) {
  for(d in unique(shp.t$detR[shp.t$Project == "maisD" & shp.t$meth == m])) {
    g <- ggplot() + 
      geom_sf(data = shp.t[shp.t$Project == "maisD" & shp.t$ant == "1-8" & shp.t$meth == m & shp.t$detR == d,],  
              aes(fill = N, color = N), lwd = 0.1) + 
      geom_sf(data = df.stat[df.stat$station.project_id == "maisD",], 
              aes(shape = plot), color = "black", fill = "white") +
      coord_sf(xlim = c(dimD[1], dimD[3]), ylim = c(dimD[2], dimD[4]))
    plot.display(g, leg = "N points", lim = c(0, 200))
  }
}

```