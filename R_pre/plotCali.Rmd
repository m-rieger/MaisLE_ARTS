---
title: "plot calibrations"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE)

Dsum <- data.frame()

tmp <- as.data.frame(df) %>% group_by(Individual, r, meth) %>%
  summarize(minD = min(PE, na.rm = T),
         maxD = max(PE, na.rm = T),
         medianD = median(PE, na.rm = T), 
         meanD = mean(PE, na.rm = T),
         NPos = n(),
            .groups = "drop")
tmp$NAnt <- 1
tmp$NStat <- 1
tmp$SigTresh <- -90

Dsum <- rbind(Dsum, tmp)


tmp <- as.data.frame(df[df$Antenna.Count >= 2 & df$Station.Count >= 2,]) %>% 
  group_by(Individual, r, meth) %>%
  summarize(minD = min(PE, na.rm = T),
            maxD = max(PE, na.rm = T),
            medianD = median(PE, na.rm = T), 
            meanD = mean(PE, na.rm = T), 
            NPos = n(),
         .groups = "drop")
tmp$NAnt <- 2
tmp$NStat <- 2
tmp$SigTresh <- -90

Dsum <- rbind(Dsum, tmp)

tmp <- as.data.frame(df[df$Antenna.Count >= 3 & df$Station.Count >= 2,]) %>% 
  group_by(Individual, r, meth) %>%
  summarize(minD = min(PE, na.rm = T),
            maxD = max(PE, na.rm = T),
            medianD = median(PE, na.rm = T), 
            meanD = mean(PE, na.rm = T), 
            NPos = n(),
                     .groups = "drop")
tmp$NAnt <- 3
tmp$NStat <- 2
tmp$SigTresh <- -90

Dsum <- rbind(Dsum, tmp)

tmp <- as.data.frame(df[df$Signal.max >= -80,]) %>% 
  group_by(Individual, r, meth) %>%
  summarize(minD = min(PE, na.rm = T),
            maxD = max(PE, na.rm = T),
            medianD = median(PE, na.rm = T), 
            meanD = mean(PE, na.rm = T), 
            NPos = n(),
                     .groups = "drop")
tmp$NAnt <- 1
tmp$NStat <- 1
tmp$SigTresh <- -80

Dsum <- rbind(Dsum, tmp)


tmp <- as.data.frame(df[df$Antenna.Count >= 2 & df$Station.Count >= 2 & df$Signal.max >= -80,]) %>% 
  group_by(Individual, r, meth) %>%
  summarize(minD = min(PE, na.rm = T),
            maxD = max(PE, na.rm = T),
            medianD = median(PE, na.rm = T), 
            meanD = mean(PE, na.rm = T), 
            NPos = n(),
                     .groups = "drop")
tmp$NAnt <- 2
tmp$NStat <- 2
tmp$SigTresh <- -80

Dsum <- rbind(Dsum, tmp)

tmp <- as.data.frame(df[df$Antenna.Count >= 3 & df$Station.Count >= 2 & df$Signal.max >= -80,]) %>% 
  group_by(Individual, r, meth) %>%
  summarize(minD = min(PE, na.rm = T),
            maxD = max(PE, na.rm = T),
            medianD = median(PE, na.rm = T), 
            meanD = mean(PE, na.rm = T), 
            NPos = n(),
                     .groups = "drop")
tmp$NAnt <- 3
tmp$NStat <- 2
tmp$SigTresh <- -80

Dsum <- rbind(Dsum, tmp)
```

```{r, fig.width=10, fig.height=4, warning = F, message = F}
## plot

for(i in unique(df$Individual)) {
  
  ggr <- ggplot(df[df$Individual == i & df$Antenna.Count >= 1,]) + 
    stat_halfeye(aes(x = r, y = PE),
                 alpha = 0.3) +
    geom_text(aes(x = r, y = 400, label = paste0(round(medianD, 2), " \n(", NPos, ")")), 
              data = Dsum[Dsum$Individual == i & Dsum$NAnt == 1 & Dsum$NStat == 1 & Dsum$SigTresh == -90,]) +
    facet_wrap(~meth, scales = "free_x") +
    xlab("det. range") +
    ylab("position error [m]") +
    
    scale_fill_viridis_d("Stations included", end = 0.9) +
    scale_color_viridis_d("Stations included", end = 0.9) +
  
    ggtitle(paste0(i, " - NStat 1, NAnt 1")) +
    theme_light(base_size = 0.8*bs)
  
  
  ggr2 <- ggplot(df[df$Individual == i & df$Antenna.Count >= 2,]) + 
    stat_halfeye(aes(x = r, y = PE),
                 alpha = 0.3) +
    geom_text(aes(x = r, y = 400, label = paste0(round(medianD, 2), " \n(", NPos, ")")), 
              data = Dsum[Dsum$Individual == i & Dsum$NAnt == 2 & Dsum$NStat == 2 & Dsum$SigTresh == -90,]) +
    facet_wrap(~meth, scales = "free_x") +
    xlab("det. range") +
    ylab("position error [m]") +
    
    scale_fill_viridis_d("Stations included", end = 0.9) +
    scale_color_viridis_d("Stations included", end = 0.9) +
    
    ggtitle(paste0(i, " - NStat 2, NAnt 2")) +
    theme_light(base_size = 0.8*bs)
  
  
  ggr3 <- ggplot(df[df$Individual == i & df$Antenna.Count >= 3,]) + 
    stat_halfeye(aes(x = r, y = PE),
                 alpha = 0.3) +
    geom_text(aes(x = r, y = 400, label = paste0(round(medianD, 2), " \n(", NPos, ")")), 
              data = Dsum[Dsum$Individual == i & Dsum$NAnt == 3 & Dsum$NStat == 2 & Dsum$SigTresh == -90,]) +
    facet_wrap(~meth, scales = "free_x") +
    xlab("det. range") +
    ylab("position error [m]") +
    
    scale_fill_viridis_d("Stations included", end = 0.9) +
    scale_color_viridis_d("Stations included", end = 0.9) +
    
    ggtitle(paste0(i, " - NStat 2, NAnt 3")) +
    theme_light(base_size = 0.8*bs)
  
  ggNAnt <- ggplot(df[df$Individual == i & df$Antenna.Count >= 1 & df$r %in% c("800m", "no"),]) + 
    stat_halfeye(aes(x = Antenna.Count, y = PE),
               alpha = 0.3) +
    facet_wrap(~meth, scales = "free_x") +
    xlab("Antenna Count") +
    ylab("position error [m]") +
    ggtitle(paste0(i, " - r 800m, NStat 1")) +
    theme_light(base_size = 0.8*bs)
  
  ggNStat <- ggplot(df[df$Individual == i & df$Station.Count >= 1 & df$r %in% c("800m", "no"),]) + 
    stat_halfeye(aes(x = Station.Count, y = PE),
                 alpha = 0.3) +
    facet_wrap(~meth, scales = "free_x") +
    xlab("Station Count") +
    ylab("position error [m]") +
    ggtitle(paste0(i, " - r 800m, NAnt 1")) +
    theme_light(base_size = 0.8*bs)
  
  ggSigMax <- ggplot(df[df$Individual == i & df$Antenna.Count >= 1 & df$r %in% c("800m", "no"),]) + 
    geom_point(aes(x = Signal.max, y = PE, color = Antenna.Count),
               alpha = 0.3, pch = 1) +
    scale_color_viridis_c("Ac", direction = -1, end = 0.9) +
    facet_wrap(~meth, scales = "free_x") +
    xlab("max. Signal") +
    ylab("position error [m]") +
    ggtitle(paste0(i, " - r 800m, NAnt 1, NStat 1")) +
    theme_light(base_size = 0.8*bs)
  

  ggWeight <- ggplot(df[df$Individual == i & df$Antenna.Count >= 1 & df$r %in% c("800m", "no"),]) + 
    geom_point(aes(x = Weight, y = PE, color = Antenna.Count),
               alpha = 0.3, pch = 1) +
    scale_color_viridis_c("Ac", direction = -1, end = 0.9) +
    facet_wrap(~meth, scales = "free_x") +
    xlab("Weight") +
    ylab("position error [m]") +
    ggtitle(paste0(i, " - r 800m, NAnt 1, NStat 1")) +
    theme_light(base_size = 0.8*bs)
  
  print(ggr)
  print(ggr2)
  print(ggr3)
  print(ggSigMax)
  print(ggWeight)
  print(ggNStat)
  print(ggNAnt)

}


```

